NameVirtualHost *:80

<VirtualHost *:80>
    ServerName dev.lmfdb.xyz

    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
    SetEnvIfNoCase Request_URI \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary

    #Dealing with proxy servers
    Header append Vary User-Agent

    ## EXPIRES CACHING ##
    ExpiresActive On
    ExpiresByType image/jpg "access 1 hour"
    ExpiresByType image/jpeg "access 1 hour"
    ExpiresByType image/gif "access 1 hour"
    ExpiresByType image/png "access 1 hour"
    ExpiresByType text/css "access 1 hour"
    ExpiresByType text/html "access 0 mintues"
    ExpiresByType application/pdf "access 10 mintues"
    ExpiresByType text/x-javascript "access 10 minutes"
    ExpiresByType image/x-icon "access 1 day"
    ExpiresDefault "access 10 minutes"

   <FilesMatch "\.(ico|jpeg|pdf|flv|jpg|png|gif|svg|js|css|swf)$">
      Header set Cache-Control "max-age=600, public"
      Header unset Last-Modified
      Header unset ETag
      FileETag None
    </FilesMatch>
    <FilesMatch "\.(html|php)$">
      #Header set Cache-Control "max-age=600, public, must-revalidate"
      Header set Cache-Control "no-cache, no-store, must-revalidate"
      Header set Pragma "no-cache"
      Header set Expires 0
    </FilesMatch>

    Alias /static /home/lmfdb/lmfdb-git-dev/lmfdb/static
    <Directory "/home/lmfdb/lmfdb-git-dev/lmfdb/static">
      Require all granted
    </Directory>

    Alias /flasklog /home/lmfdb/lmfdb-git-dev/flasklog
    <Directory "/home/lmfdb/lmfdb-git-dev">
      Require all granted
    </Directory>

    #Alias /data /home/lmfdb/data
    #<Directory "/home/lmfdb/data">
    #  Options Indexes FollowSymLinks
    #  Require all granted
    #</Directory>

    ProxyPass /flasklog !
    ProxyPass /static !
    ProxyPass /MathJax !
    #ProxyPass /data !
    ProxyPass /icons !
    ProxyPass        / http://localhost:8080/
    ProxyPassReverse / http://localhost:8080/

    CustomLog /var/log/apache2/dev-access.log combined
</VirtualHost>


<VirtualHost *:80>
    ServerName postgres.lmfdb.xyz
    ServerAlias legendre.mit.edu

    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
    SetEnvIfNoCase Request_URI \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary

    #Dealing with proxy servers
    Header append Vary User-Agent

    ## EXPIRES CACHING ##
    ExpiresActive On
    ExpiresByType image/jpg "access 1 hour"
    ExpiresByType image/jpeg "access 1 hour"
    ExpiresByType image/gif "access 1 hour"
    ExpiresByType image/png "access 1 hour"
    ExpiresByType text/css "access 1 hour"
    ExpiresByType text/html "access 0 mintues"
    ExpiresByType application/pdf "access 10 mintues"
    ExpiresByType text/x-javascript "access 10 minutes"
    ExpiresByType image/x-icon "access 1 day"
    ExpiresDefault "access 10 minutes"

 <FilesMatch "\.(ico|jpeg|pdf|flv|jpg|png|gif|svg|js|css|swf)$">
    Header set Cache-Control "max-age=30, public, must-revalidate"
    Header unset Last-Modified
    Header unset ETag
    FileETag None
  </FilesMatch>

  <FilesMatch "\.(html|php)$">
      #Header set Cache-Control "max-age=600, public, must-revalidate"
      Header set Cache-Control "no-cache, no-store, must-revalidate"
      Header set Pragma "no-cache"
      Header set Expires 0
  </FilesMatch>

    Alias /static /home/lmfdb/lmfdb-git-postgres/lmfdb/static
    <Directory "/home/lmfdb/lmfdb-git-postgres/lmfdb/static">
      Require all granted
    </Directory>

    #Alias /data /home/lmfdb/data
    #<Directory "/home/lmfdb/data">
    #  Require all granted
    #</Directory>

    Alias /flasklog /home/lmfdb/lmfdb-git-postgres/flasklog
    <Directory "/home/lmfdb/lmfdb-git-postgres">
      Require all granted
    </Directory>

    ProxyPass /ganglia !
    ProxyPass /flasklog !
    ProxyPass /static !
    ProxyPass /MathJax !
    #ProxyPass /data !
    ProxyPass /icons !
    ProxyPass        / http://localhost:8082/
    ProxyPassReverse / http://localhost:8082/

    CustomLog /var/log/apache2/postgres-access.log combined
</VirtualHost>
